<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>مزيكتك — أورج 24 مفتاح</title>
<style>
  body{margin:0;font-family:sans-serif;background:#0f1724;color:#fff;display:flex;flex-direction:column;align-items:center;padding:10px;}
  h1{color:#ff8a00;margin-bottom:10px;font-family:"Pacifico",cursive;}
  .keyboard{display:flex;position:relative;width:100%;max-width:1000px;height:200px;margin:10px 0;user-select:none;touch-action:none;}
  .key.white{flex:1;background:#fff;height:100%;border:1px solid #000;position:relative;display:flex;align-items:flex-end;justify-content:center;color:#000;font-weight:600;cursor:pointer;}
  .key.black{width:40px;height:120px;background:#111;color:#fff;position:absolute;z-index:2;top:0;border-radius:4px;display:flex;align-items:flex-end;justify-content:center;cursor:pointer;}
  .key.white.active{background:#ffd89a;}
  .key.black.active{background:#ffb74d;}
  .controls{display:flex;flex-wrap:wrap;gap:12px;padding:10px;background:rgba(255,255,255,0.02);border-radius:8px;}
  label{font-size:0.85rem;margin-bottom:4px;display:block;}
  input[type=range]{width:120px;}
  select, input[type=checkbox], button{background:rgba(255,255,255,0.02);color:#fff;border:1px solid rgba(255,255,255,0.06);padding:6px;border-radius:6px;}
  button{cursor:pointer;}
  footer{margin-top:12px;font-size:0.9rem;color:#9fb3d8;}
</style>
<link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
</head>
<body>

<h1>مزيكتك — أورج</h1>

<div class="controls">
  <div>
    <label>نوع الموجة</label>
    <select id="waveType">
      <option value="sine">Sine</option>
      <option value="square">Square</option>
      <option value="triangle">Triangle</option>
      <option value="sawtooth" selected>Sawtooth</option>
    </select>
  </div>
  <div>
    <label>حجم عام</label>
    <input type="range" id="masterGain" min="0" max="1" step="0.01" value="0.6">
  </div>
  <div>
    <label>Sustain</label>
    <input type="checkbox" id="sustainChk" checked>
  </div>
</div>

<div class="keyboard" id="keyboard"></div>

<footer>استعمل الماوس أو لوحة المفاتيح (مفتاح المسافة للباس)</footer>

<script>
const ctx = new (window.AudioContext || window.webkitAudioContext)();
const masterGain = ctx.createGain();
masterGain.gain.value = 0.6;
masterGain.connect(ctx.destination);

const waveSelect = document.getElementById('waveType');
const masterInput = document.getElementById('masterGain');
const sustainChk = document.getElementById('sustainChk');

masterInput.addEventListener('input', e => masterGain.gain.value = parseFloat(e.target.value));

const baseNotes = [
  130.81,138.59,146.83,155.56,164.81,174.61,184.99,195.99,207.65,220.00,233.08,246.94,
  261.63,277.18,293.66,311.13,329.63,349.23,369.99,391.99,415.30,440.00,466.16,493.88
];

const keyboard = document.getElementById('keyboard');
const keys = [];

function buildKeyboard(){
  keyboard.innerHTML='';
  const whiteOrder = ['C','D','E','F','G','A','B'];
  let whiteIndex = 0;
  baseNotes.forEach((freq,i)=>{
    const isSharp = [1,3,6,8,10,13,15,18,20,22].includes(i);
    if(!isSharp){
      const key = document.createElement('div');
      key.className='key white';
      key.dataset.index=i;
      key.textContent=whiteOrder[whiteIndex%7];
      keyboard.appendChild(key);
      keys.push({el:key,freq:freq});
      whiteIndex++;
    }
  });
  // add black keys
  const whiteEls = Array.from(document.querySelectorAll('.key.white'));
  whiteEls.forEach((wEl,i)=>{
    const blackIdx = [0,1,3,4,5,7,8,10,11,12,14,15].includes(i)?i+1:null;
    if(blackIdx!==null && blackIdx<baseNotes.length){
      const bEl = document.createElement('div');
      bEl.className='key black';
      bEl.dataset.index=blackIdx;
      bEl.textContent='#';
      keyboard.appendChild(bEl);
      keys.push({el:bEl,freq:baseNotes[blackIdx]});
      setTimeout(()=>bEl.style.left=(wEl.offsetLeft + wEl.offsetWidth*0.75)+'px',0);
    }
  });
}

buildKeyboard();

const activeNotes = new Map();

function playNote(idx){
  const freq = baseNotes[idx];
  if(!freq) return;
  const osc = ctx.createOscillator();
  osc.type = waveSelect.value;
  osc.frequency.value = freq;
  const g = ctx.createGain();
  g.gain.value=0;
  osc.connect(g); g.connect(masterGain);
  osc.start();
  const attack=0.01;
  const release=0.3;
  g.gain.linearRampToValueAtTime(1,ctx.currentTime+attack);
  activeNotes.set(idx,{osc,g});
  // highlight
  const k = document.querySelector(`.key[data-index="${idx}"]`);
  if(k) k.classList.add('active');
}

function stopNote(idx){
  const note = activeNotes.get(idx);
  if(note){
    const g = note.g;
    g.gain.cancelScheduledValues(ctx.currentTime);
    g.gain.setValueAtTime(g.gain.value,ctx.currentTime);
    g.gain.linearRampToValueAtTime(0,ctx.currentTime+0.3);
    setTimeout(()=>note.osc.stop(),350);
    activeNotes.delete(idx);
    const k = document.querySelector(`.key[data-index="${idx}"]`);
    if(k) k.classList.remove('active');
  }
}

keys.forEach(k=>{
  k.el.addEventListener('mousedown',()=>playNote(parseInt(k.el.dataset.index)));
  k.el.addEventListener('mouseup',()=>stopNote(parseInt(k.el.dataset.index)));
  k.el.addEventListener('mouseleave',()=>stopNote(parseInt(k.el.dataset.index)));
  k.el.addEventListener('touchstart',e=>{e.preventDefault(); playNote(parseInt(k.el.dataset.index))},{passive:false});
  k.el.addEventListener('touchend',e=>{e.preventDefault(); stopNote(parseInt(k.el.dataset.index))},{passive:false});
});

// keyboard events
const keyMap = {'a':0,'w':1,'s':2,'e':3,'d':4,'f':5,'t':6,'g':7,'y':8,'h':9,'u':10,'j':11,'k':12,'o':13,'l':14,'p':15,';':16,"'":17};
const pressedKeys = new Set();
window.addEventListener('keydown',e=>{
  const k = e.key.toLowerCase();
  if(keyMap[k]!==undefined && !pressedKeys.has(k)){
    pressedKeys.add(k);
    playNote(keyMap[k]);
  }
});
window.addEventListener('keyup',e=>{
  const k = e.key.toLowerCase();
  if(keyMap[k]!==undefined){
    pressedKeys.delete(k);
    stopNote(keyMap[k]);
  }
});
</script>

</body>
</html>
