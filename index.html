<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>مزيكتك</title>
<style>
body{margin:0;font-family:sans-serif;background:#0f1724;color:#fff;display:flex;flex-direction:column;align-items:center;padding:10px;}
h1{color:#ff8a00;margin-bottom:10px;font-family:"Pacifico",cursive;}
.keyboard{position:relative;width:100%;max-width:1000px;height:200px;margin:10px 0;user-select:none;touch-action:none;}
.key.white{position:relative;float:left;width:calc(100%/14);height:100%;background:#fff;border:1px solid #000;box-shadow:0 3px 3px rgba(0,0,0,0.3);border-radius:0 0 6px 6px;display:flex;align-items:flex-end;justify-content:center;color:#000;font-weight:600;cursor:pointer;z-index:1;}
.key.white.active{background:#ffd89a;}
.key.black{position:absolute;width:calc(100%/21);height:130px;background:#111;color:#fff;top:0;border-radius:4px;box-shadow:0 3px 6px rgba(0,0,0,0.5);display:flex;align-items:flex-end;justify-content:center;cursor:pointer;z-index:2;}
.key.black.active{background:#ffb74d;}
.controls{display:flex;flex-wrap:wrap;gap:12px;padding:10px;background:rgba(255,255,255,0.02);border-radius:8px;}
label{font-size:0.85rem;margin-bottom:4px;display:block;}
input[type=range]{width:120px;}
select,input[type=checkbox],button{background:rgba(255,255,255,0.02);color:#fff;border:1px solid rgba(255,255,255,0.06);padding:6px;border-radius:6px;}
button{cursor:pointer;}
footer{margin-top:12px;font-size:0.9rem;color:#9fb3d8;}
</style>
<link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
</head>
<body>

<h1>مزيكتك</h1>

<div class="controls">
  <div>
    <label>نوع الموجة</label>
    <select id="waveType">
      <option value="sine">Sine</option>
      <option value="square">Square</option>
      <option value="triangle">Triangle</option>
      <option value="sawtooth" selected>Sawtooth</option>
    </select>
  </div>
  <div>
    <label>حجم عام</label>
    <input type="range" id="masterGain" min="0" max="1" step="0.01" value="0.6">
  </div>
  <div>
    <label>Sustain</label>
    <input type="checkbox" id="sustainChk" checked>
  </div>
</div>

<div class="keyboard" id="keyboard"></div>

<footer>استعمل الماوس أو لوحة المفاتيح (مفتاح المسافة للباس)</footer>

<script>
const ctx = new (window.AudioContext || window.webkitAudioContext)();
const masterGain = ctx.createGain();
masterGain.gain.value=0.6;
masterGain.connect(ctx.destination);

const waveSelect=document.getElementById('waveType');
const masterInput=document.getElementById('masterGain');

masterInput.addEventListener('input',e=>masterGain.gain.value=parseFloat(e.target.value));

const whiteNotes = [130.81,146.83,164.81,174.61,196.00,220.00,246.94,261.63,293.66,329.63,349.23,392.00,440.00,493.88];
const blackNotes = [138.59,155.56,184.99,207.65,233.08,277.18,311.13,369.99,415.30,466.16];

const keyboard=document.getElementById('keyboard');
const keys=[];

function buildKeyboard(){
  keyboard.innerHTML='';
  // white keys
  whiteNotes.forEach((freq,i)=>{
    const key=document.createElement('div');
    key.className='key white';
    key.dataset.freq=freq;
    keyboard.appendChild(key);
    keys.push({el:key,freq:freq});
  });
  // black keys positions
  const positions=[0,1,3,4,5,7,8,10,11,12]; // index above white keys
  positions.forEach((pos,i)=>{
    const key=document.createElement('div');
    key.className='key black';
    key.dataset.freq=blackNotes[i];
    keyboard.appendChild(key);
    key.style.left=(keyboard.children[pos].offsetLeft + keyboard.children[pos].offsetWidth*0.65)+'px';
    keys.push({el:key,freq:blackNotes[i]});
  });
}

buildKeyboard();

const activeNotes = new Map();

function playNote(freq){
  if(activeNotes.has(freq)) return;
  const osc=ctx.createOscillator();
  osc.type=waveSelect.value;
  osc.frequency.value=freq;
  const g=ctx.createGain();
  g.gain.value=0;
  osc.connect(g); g.connect(masterGain);
  osc.start();
  g.gain.linearRampToValueAtTime(1,ctx.currentTime+0.01);
  activeNotes.set(freq,{osc,g});
}

function stopNote(freq){
  const note=activeNotes.get(freq);
  if(note){
    note.gain=note.g;
    note.gain.gain.cancelScheduledValues(ctx.currentTime);
    note.gain.gain.setValueAtTime(note.gain.gain.value,ctx.currentTime);
    note.gain.gain.linearRampToValueAtTime(0,ctx.currentTime+0.3);
    setTimeout(()=>note.osc.stop(),350);
    activeNotes.delete(freq);
  }
}

keys.forEach(k=>{
  k.el.addEventListener('mousedown',()=>playNote(k.freq));
  k.el.addEventListener('mouseup',()=>stopNote(k.freq));
  k.el.addEventListener('mouseleave',()=>stopNote(k.freq));
  k.el.addEventListener('touchstart',e=>{e.preventDefault(); playNote(k.freq)},{passive:false});
  k.el.addEventListener('touchend',e=>{e.preventDefault(); stopNote(k.freq)},{passive:false});
});
</script>

</body>
</html>
